/*VIM: set ts=2 */
%{
=head1 SYNOPSIS

See 
   
   http://search.cpan.org/perldoc?Parse::Eyapp::debuggingtut
   file DebugLookForward.eyp

This grammar fixes the conflicts an bugs in Debug.eyp and Debug1.eyp

Be sure C<DebugTail.pm> is reachable
compile it with 

      eyapp -b '' DebugLookForward.eyp

execute the generated modulino with:

      ./DebugLookForward.pm -t

=head1 See also

    Debug.eyp Debug1.eyp Debug2.eyp 

=cut

our $VERSION = '0.01';
use base q{DebugTail}; 

%}

%token D S
%syntactic token SEMICOLONS SEMICOLOND

%tree

%%
p:
    %name P
    ds SEMICOLONS ss  
  | %name SS
    ss
;

ds:
    %name D2
      D SEMICOLOND ds   
  | %name D1
      D       
;

ss:
    %name S2
      S SEMICOLONS ss     
  | %name S1
      S       
;

%%

__PACKAGE__->lexer(
  sub {
    my $self = shift;
    
    for (${$self->input()}) {
       s{^(\s+)}{} and $self->tokenline($1 =~ tr{\n}{});
       return ('',undef) unless $_;

       return ($1,$1) if s/^([sSDd])//;
       return ('SEMICOLOND', 'SEMICOLOND') if s/^;\s*D/D/;
       return ('SEMICOLONS', 'SEMICOLONS') if s/^;\s*S/S/;
       die "Syntax error at line num ${$self->tokenline()}: ${substr($_,0,10)}\n";
    }
    return ('',undef);
  }
);

__PACKAGE__->main unless caller();

